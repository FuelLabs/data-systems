# ------------------------------------------------------------
# Fuel-streams package
# ------------------------------------------------------------
[packages.fuel-streams]
versioned_files = [
    "crates/fuel-streams/Cargo.toml",
    "Cargo.lock",
    { path = "Cargo.toml", dependency = "fuel-streams" },
]
changelog = "CHANGELOG.md"
extra_changelog_sections = [
    { types = [
        "major",
    ], name = "‚ö†Ô∏è Breaking Change" },
    { types = [
        "minor",
    ], name = "üöÄ Features" },
    { types = [
        "patch",
    ], name = "üêõ Fixes" },
    { footers = [
        "Changelog-Note",
    ], name = "üìù Notes" },
]

# ------------------------------------------------------------
# Workflow to get the current version
# ------------------------------------------------------------
[[workflows]]
name = "get-version"
help_text = "Get the current version of the project"

[[workflows.steps]]
type = "Command"
command = "echo \"$VERSION\""
variables = { "$VERSION" = "Version" }

# ------------------------------------------------------------
# Workflow to create a new changeset
# ------------------------------------------------------------
[[workflows]]
name = "changeset"

[[workflows.steps]]
type = "CreateChangeFile"

# ------------------------------------------------------------
# Workflow to create a new release
# ------------------------------------------------------------
[[workflows]]
name = "prepare-release"

[[workflows.steps]]
type = "PrepareRelease"

[[workflows.steps]]
type = "Command"
command = "git switch -c $RELEASE_BRANCH"
shell = true

[[workflows.steps]]
type = "Command"
command = "./scripts/bump-version.sh $VERSION && git add ."
variables = { "$VERSION" = "Version" }
shell = true

[[workflows.steps]]
type = "Command"
command = "git commit -m \"ci(release): Preparing $VERSION\""
variables = { "$VERSION" = "Version" }

[[workflows.steps]]
type = "Command"
command = "git push --force --set-upstream origin $RELEASE_BRANCH"
shell = true

[[workflows.steps]]
type = "CreatePullRequest"
base = "main"
variables = { "$VERSION" = "Version" }

[workflows.steps.title]
template = "ci(release): Preparing v$VERSION"
variables = { "$VERSION" = "Version" }

[workflows.steps.body]
template = "v$VERSION"
variables = { "$VERSION" = "Version" }

# ------------------------------------------------------------
# Workflow to create a changeset
# ------------------------------------------------------------
[[workflows]]
name = "document-change"

[[workflows.steps]]
type = "CreateChangeFile"

# ------------------------------------------------------------
# Workflow to release a new version
# ------------------------------------------------------------
[[workflows]]
name = "release"

[[workflows.steps]]
type = "Release"
variables = { "$VERSION" = "Version" }

# ------------------------------------------------------------
# GitHub configuration
# ------------------------------------------------------------
[github]
owner = "fuellabs"
repo = "data-systems"
