# Default values for fuel-streams-publisher
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 1

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 3
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

image:
  repository: ghcr.io/fuellabs/fuel-streams-publisher
  pullPolicy: Always
  tag: "f81cde1"

serviceAccount:
  create: false
  automount: true

service:
  type: ClusterIP
  port: 4000
  metrics_port: 9000

# Environment variables configuration
env:
  # Non-sensitive configuration
  RELAYER_V2_LISTENING_CONTRACTS: "0xAEB0c00D0125A8a788956ade4f4F12Ead9f65DDf"
  RELAYER_DA_DEPLOY_HEIGHT: "20620434"
  RELAYER_LOG_PAGE_SIZE: "2000"
  SYNC_HEADER_BATCH_SIZE: "100"
  NATS_URL: "nats:4222"
  P2P_PORT: "30333"
  RESERVED_NODES: "/dnsaddr/mainnet.fuel.network"
  CHAIN_CONFIG: "mainnet"
  PUBLISHER_MAX_THREADS: "32"
  DB_PATH: "/mnt/db/"
  POA_INSTANT: "false"
  SERVICE_NAME: "NATS Publisher Node"

# Sensitive environment variables (should be overridden securely)
secrets:
  RELAYER: ""  # Should be provided securely
  KEYPAIR: ""  # Should be provided securely
  NATS_ADMIN_PASS: ""  # Should be provided securely

securityContext:
  capabilities:
    drop: [ALL]
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 1000

livenessProbe:
  httpGet:
    path: /v1/health
    port: 4000

readinessProbe:
  httpGet:
    path: /v1/health
    port: 4000

resources:
  requests:
    cpu: 1000m
    memory: 2Gi
  limits:
    cpu: 2000m
    memory: 4Gi

initContainers:
  - name: update-db-folder
    image: alpine:latest
    imagePullPolicy: IfNotPresent
    command: ["/bin/chown"]
    args: ["-R", "1000:1000", "/mnt/db"]
    volumeMounts:
      - name: rocks-db
        mountPath: /mnt/db
  - name: update-temp-folder
    image: alpine:latest
    imagePullPolicy: IfNotPresent
    command: ["/bin/chown"]
    args: ["-R", "1000:1000", "/tmp"]
    volumeMounts:
      - name: tmp-folder
        mountPath: /tmp

volumeClaimTemplates:
  - metadata:
      name: rocks-db
    spec:
      accessModes: ["ReadWriteOnce"]
      storageClassName: gp3-generic
      resources:
        requests:
          storage: 800Gi
  - metadata:
      name: tmp-folder
    spec:
      accessModes: ["ReadWriteOnce"]
      storageClassName: gp3-generic
      resources:
        requests:
          storage: 5Gi

volumeMounts:
  - name: rocks-db
    mountPath: "/mnt/db"
    readOnly: false
  - name: tmp-folder
    mountPath: "/tmp"
    readOnly: false