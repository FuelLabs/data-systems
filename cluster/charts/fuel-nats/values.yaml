# External service configuration (for production)
externalService:
  enabled: false # Enable for production

# TLS configuration (for production)
tls:
  enabled: false
  issuer: letsencrypt-prod

nats:
  promExporter:
    enabled: false
    port: 6777
    image:
      repository: natsio/prometheus-nats-exporter
      tag: 0.15.0
    podMonitor:
      enabled: false
      metadata:
        labels:
          release: kube-prometheus-stack

  container:
    image:
      repository: nats
      tag: 2.10.22-alpine
    env:
      GOMEMLIMIT: 3GiB
      NATS_SYSTEM_PASS: temp-system-pass # Override in production
      NATS_ADMIN_PASS: temp-admin-pass # Override in production
    startupProbe:
      initialDelaySeconds: 60
      periodSeconds: 10
      failureThreshold: 1080
    resources:
      requests:
        cpu: 4
        memory: 4Gi

  serviceAccount:
    enabled: true

  service:
    enabled: true
    ports:
      nats:
        enabled: true
      cluster:
        enabled: false # Set this true on production
      monitor:
        enabled: false
      mqtt:
        enabled: false
      leafnodes:
        enabled: false
      websocket:
        enabled: true

  config:
    cluster:
      enabled: false # Set this true on production
      port: 6222
      replicas: 3
      routeURLs:
        useFQDN: true

    jetstream:
      enabled: true
      fileStore:
        dir: /data
        pvc:
          enabled: true
          size: 10Gi
          storageClassName: standard

    websocket:
      enabled: true
      port: 8443
      merge:
        no_tls: true
      # Configuration to setup TLS on production for websocket
      # tls:
      #   enabled: true
      #   secretName: nats-ws-tls
      #   dir: /etc/nats-certs/websocket
      #   cert: tls.crt
      #   key: tls.key
      # merge:
      #   no_tls: false
      #   same_origin: false
      #   compression: false
      #   handshake_timeout: "20s"
      #   no_auth_user: default_user

    merge:
      jetstream:
        max_file_store: << 100GiB >>
        max_memory_store: << 7168MiB >>
      max_payload: << 8MiB >>
      system_account: SYS
      accounts:
        SYS:
          users:
            - user: system
              password: << $NATS_SYSTEM_PASS >>
        USERS:
          jetstream: enabled
          users:
            - user: admin
              password: << $NATS_ADMIN_PASS >>
              permissions:
                publish: ">"
                subscribe: ">"
            - user: default_user
              permissions:
                subscribe: ">"
                publish:
                  deny:
                    - "*.by_id.>"
                    - "*.blocks.>"
                    - "*.transactions.>"
                    - "*.inputs.>"
                    - "*.outputs.>"
                    - "*.receipts.>"
                    - "*.logs.>"
                    - "*.utxos.>"
                    - "$JS.API.STREAM.CREATE.>"
                    - "$JS.API.STREAM.UPDATE.>"
                    - "$JS.API.STREAM.DELETE.>"
                    - "$JS.API.STREAM.PURGE.>"
                    - "$JS.API.STREAM.RESTORE.>"
                    - "$JS.API.STREAM.MSG.DELETE.>"
                    - "$JS.API.CONSUMER.DURABLE.CREATE.>"
