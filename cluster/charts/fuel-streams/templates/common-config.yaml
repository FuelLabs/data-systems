{{- $localSecrets := .Values.localSecrets -}}
{{- $configMap := .Values.commonConfigMap -}}
{{- $configMapDict := dict "root" . "context" $configMap "name" "config" "component" "config" -}}
{{- $localSecretsDict := dict "root" . "context" $localSecrets "name" "keys" "component" "config" -}}
{{- if .Values.commonConfigMap.enabled }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  {{- include "k8s.resource-metadata" $configMapDict | nindent 2 }}
data:
  {{ $configMap.data | toYaml | nindent 2 }}
{{- end }}
{{- if .Values.localSecrets.enabled }}
---
apiVersion: v1
kind: Secret
metadata:
  {{- include "k8s.resource-metadata" $localSecretsDict | nindent 2 }}
stringData:
  {{ $localSecrets.data | toYaml | nindent 2 }}
{{- end }}
---
{{- $grafanaDict := dict "context" (dict
  "prometheusDataSource" .Values.config.prometheus.dataSource
) -}}
{{- if .Values.config.prometheus.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "fuel-streams.fullname" $root }}-overview-metrics
  annotations:
    grafana_folder: "Fuel Streams"
  labels:
    grafana_dashboard: "1"
    app.kubernetes.io/name: {{ include "fuel-streams.name" . }}
    app.kubernetes.io/instance: {{ .Release.Name }}
data:
  overview-metrics.json: |-
    {{- tpl (.Files.Get "dashboards/overview-metrics.json") $grafanaDict | nindent 4 }}
{{- end }}
