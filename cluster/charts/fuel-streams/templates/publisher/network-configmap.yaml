{{- $publisher := .Values.publisher }}
apiVersion: v1
kind: ConfigMap
metadata:
  {{- include "k8s.metadata" (dict "context" . "suffix" "-network-config") | nindent 2 }}
  annotations:
    {{- include "set-value" (dict "context" $publisher "path" "config.annotations") | nindent 4 }}
  labels:
    {{- include "fuel-streams.labels" . | nindent 4 }}
    {{- include "set-value" (dict "context" $publisher "path" "config.labels") | nindent 4 }}
    app.kubernetes.io/component: publisher
data:
  ARGS: >-
    --enable-relayer
    --keypair=${KEYPAIR}
    --relayer=${RELAYER}
    --ip=0.0.0.0
    --port=${PORT}
    --peering-port=30333
    --db-path=${DB_PATH}
    --utxo-validation
    --poa-instant=false
    --enable-p2p
    --sync-header-batch-size=100
    --relayer-log-page-size=2000
    --sync-block-stream-buffer-size=50
    --nats-url=${NATS_URL}
    --max-database-cache-size=17179869184
    --state-rewind-duration=136y
    --request-timeout=60
    --graphql-max-complexity=1000000000
  {{- if eq $publisher.network "mainnet" }}
  NETWORK_ARGS: >-
    --service-name="Publisher Node (Mainnet)"
    --snapshot=./chain-config/mainnet
    --reserved-nodes=/dnsaddr/mainnet.fuel.network
    --relayer-v2-listening-contracts=0xAEB0c00D0125A8a788956ade4f4F12Ead9f65DDf
    --relayer-da-deploy-height=20620434
  {{- else if eq $publisher.network "testnet" }}
  NETWORK_ARGS: >-
    --service-name="Publisher Node (Testnet)"
    --snapshot=./chain-config/testnet
    --reserved-nodes=/dns4/p2p-testnet.fuel.network/tcp/30333/p2p/16Uiu2HAmDxoChB7AheKNvCVpD4PHJwuDGn8rifMBEHmEynGHvHrf,/dns4/p2p-testnet.fuel.network/tcp/30333/p2p/16Uiu2HAmHnANNk4HjAxQV66BNCRxd2MBUU89ijboZkE69aLuSn1g,/dns4/p2p-testnet.fuel.network/tcp/30333/p2p/16Uiu2HAmVE468rpkh2X1kzz8qQXmqNFiPxU5Lrya28nZdbRUdVJX
    --relayer-v2-listening-contracts=0x01855B78C1f8868DE70e84507ec735983bf262dA
    --relayer-da-deploy-height=5827607
  {{- end }}
