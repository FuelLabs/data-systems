suite: Testing Publisher secret
templates:
  - templates/publisher/secret.yaml
tests:
  - it: should not create secret when secrets are not defined
    set:
      publisher.enabled: true
      publisher.secrets: null
    asserts:
      - hasDocuments:
          count: 0

  - it: should create secret with correct metadata and type
    set:
      publisher.enabled: true
      publisher.secrets:
        RELAYER: test-relayer
        KEYPAIR: test-keypair
    asserts:
      - isKind:
          of: Secret
      - equal:
          path: metadata.name
          value: RELEASE-NAME-fuel-streams-publisher
      - equal:
          path: type
          value: Opaque

  - it: should set custom annotations when provided
    set:
      publisher.enabled: true
      publisher.secrets:
        RELAYER: test-relayer
      publisher.config.annotations:
        custom.annotation/test: "true"
    asserts:
      - equal:
          path: 'metadata.annotations["custom.annotation/test"]'
          value: "true"

  - it: should set custom labels when provided
    set:
      publisher.enabled: true
      publisher.secrets:
        RELAYER: test-relayer
      publisher.config.labels:
        custom.label/test: "true"
    asserts:
      - equal:
          path: 'metadata.labels["custom.label/test"]'
          value: "true"

  - it: should properly set secret data
    set:
      publisher.enabled: true
      publisher.secrets:
        RELAYER: test-relayer-value
        KEYPAIR: test-keypair-value
        NATS_ADMIN_PASS: test-nats-pass
    asserts:
      - equal:
          path: stringData.RELAYER
          value: test-relayer-value
      - equal:
          path: stringData.KEYPAIR
          value: test-keypair-value
      - equal:
          path: stringData.NATS_ADMIN_PASS
          value: test-nats-pass